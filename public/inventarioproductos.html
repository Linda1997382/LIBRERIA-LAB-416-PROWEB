<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azul Book store</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="css/inventarioproductos.css">
</head>

<body>

    <header>
        <nav class="navbar navbar-expand-lg navy-bg">
            <a class="navbar-brand" href="index.html">
                <img id="IMG1" src="https://i.imgur.com/7w4wg5l.png" class="img-fluid">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="Soporte.html">Soporte<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="sobrenosotros.html">Sobre nosotros</a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0 search-bar">
                    <input class="form-control mr-sm-2" type="search" placeholder="Buscar" aria-label="Buscar">
                    <button id="search-btn" class="btn btn-outline-success my-2 my-sm-0" type="button">Buscar</button>
                </form>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link sign-out-list-item" href="#">Cerrar Sesión <i
                                class="fas fa-sign-out-alt sign-out-icon"></i></a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="navy-bg text-center mb-4">
                    <h2 class="title profile2"><i class="fas fa-user user-icon"></i>Administrador</h2>
                </div>
                <ul class="list-group">
                    <li class="list-group-item profile-list-item"><a class="nav-link styled-link" href="miperfiladmin.html"><i class="fas fa-user"></i> Mi Perfil Administrador</a></li>
                    <li class="list-group-item cart-list-item"><a class="nav-link styled-link" href="inventarioproductos.html"><i class="fas fa-shopping-cart cart-icon"></i> Inventario de Productos</a></li>
                    <li class="list-group-item"><a class="nav-link styled-link" href="administracioncuentas.html"><i class="fas fa-user-cog"></i> Administración de cuentas</a></li>
                    <li class="list-group-item"><a class="nav-link styled-link" href="autores.html"><i class="fas fa-users"></i> Autores</a></li>
                    <li class="list-group-item"><a class="nav-link styled-link" href="editoriales.html"><i class="fas fa-book"></i> Editoriales</a></li>
                    <li class="list-group-item"><a class="nav-link styled-link" href="categorias.html"><i class="fas fa-tags"></i> Categorías</a></li>
                    <li class="list-group-item"><a class="nav-link styled-link" href="reportes.html"><i class="fas fa-chart-bar"></i> Reportes</a></li>
                </ul>
            </div>

            <div class="col-md-8">
                <div>
                    <h3 class="profile-section-title">Inventario de Productos</h3>
                    <p><strong>Hola [Administrador]</strong></p>
                    <p>Desde aquí tienes la posibilidad de ver los productos añadidos y actualizar su disponibilidad. Además de que también puedes implementar nuevos productos.</p>
                    <hr>
                    <!-- Funcionalidad CRUD -->
                    <div>
                        <h1>Administrar Libros</h1>
    <form id="bookForm">
      <div class="form-group">
        <label for="titulo">Título</label>
        <input type="text" class="form-control" id="titulo" required>
      </div>
      <div class="form-group">
        <label for="autorID">AutorID</label>
        <input type="number" class="form-control" id="autorID" required>
      </div>
      <div class="form-group">
        <label for="editorialID">EditorialID</label>
        <input type="number" class="form-control" id="editorialID" required>
      </div>
      <div class="form-group">
        <label for="precio">Precio</label>
        <input type="number" class="form-control" id="precio" step="0.01" required>
      </div>
      <div class="form-group">
        <label for="descripcion">Descripción</label>
        <textarea class="form-control" id="descripcion" rows="3" required></textarea>
      </div>
      <div class="form-group">
        <label for="categoriaID">CategoriaID</label>
        <input type="number" class="form-control" id="categoriaID" required>
      </div>
      <div class="form-group">
        <label for="imagen">Imagen</label>
        <input type="text" class="form-control" id="imagen">
      </div>
      <button type="submit" class="btn btn-primary">Guardar</button>
    </form>
    <div id="message"></div>
                    </div>
                    <h1>Libros</h1>
    <div id="books"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar un libro -->
    <div id="editBookModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeEditModal()">&times;</span>
          <h2>Editar Libro</h2>
      <form id="editBookForm">
        <div>
          <label for="titulo">Título:</label>
          <input type="text" id="titulo" name="titulo" required>
        </div>
        <div>
          <label for="autorID">Autor ID:</label>
          <input type="text" id="autorID" name="autorID" required>
        </div>
        <div>
          <label for="editorialID">Editorial ID:</label>
          <input type="text" id="editorialID" name="editorialID" required>
        </div>
        <div>
          <label for="precio">Precio:</label>
          <input type="text" id="precio" name="precio" required>
        </div>
        <div>
          <label for="descripcion">Descripción:</label>
          <textarea id="descripcion" name="descripcion" required></textarea>
        </div>
        <div>
          <label for="categoriaID">Categoría ID:</label>
          <input type="text" id="categoriaID" name="categoriaID" required>
        </div>
        <div>
          <label for="imagen">URL de la Imagen:</label>
          <input type="text" id="imagen" name="imagen" required>
        </div>
        <button type="submit">Guardar Cambios</button>
      </form>
    </div>
  </div>
  
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        //agregar/editar libros
        document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('bookForm');
      const messageDiv = document.getElementById('message');

      form.addEventListener('submit', async function (event) {
        event.preventDefault();

        const titulo = form.titulo.value;
        const autorID = form.autorID.value;
        const editorialID = form.editorialID.value;
        const precio = form.precio.value;
        const descripcion = form.descripcion.value;
        const categoriaID = form.categoriaID.value;
        const imagen = form.imagen.value;

        // Enviar los datos al servidor
        try {
          const response = await fetch('http://localhost:3000/api/books', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ Titulo: titulo, AutorID: autorID, EditorialID: editorialID, Precio: precio, Descripcion: descripcion, CategoriaID: categoriaID, Imagen: imagen }),
          });

          const result = await response.json();

          if (response.ok) {
            showMessage('Libro guardado exitosamente', 'success');
            form.reset();
          } else {
            showMessage(result.message, 'danger');
          }
        } catch (error) {
          showMessage('Error al guardar el libro. Inténtalo de nuevo más tarde.', 'danger');
        }
      });

      function showMessage(message, type) {
        messageDiv.innerHTML = `<div class="alert alert-${type}" role="alert">${message}</div>`;
      }
    });

    //ver lista de libros
    document.addEventListener('DOMContentLoaded', async function () {
      const booksDiv = document.getElementById('books');

      try {
        const response = await fetch('http://localhost:3000/api/books');
        const books = await response.json();

        if (response.ok) {
          booksDiv.innerHTML = `
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Título</th>
                  <th>AutorID</th>
                  <th>EditorialID</th>
                  <th>Precio</th>
                  <th>Descripción</th>
                  <th>CategoriaID</th>
                  <th>Imagen</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                ${books.map(book => `
                  <tr>
                    <td>${book.ID}</td>
                    <td>${book.Titulo}</td>
                    <td>${book.AutorID}</td>
                    <td>${book.EditorialID}</td>
                    <td>${book.Precio}</td>
                    <td>${book.Descripcion}</td>
                    <td>${book.CategoriaID}</td>
                    <td>${book.Imagen}</td>
                    <td>
                      <button onclick="deleteBook(${book.ID})" class="btn btn-danger">Eliminar</button>
                      <button onclick="editBook(${book.ID})" class="btn btn-warning">Editar</button>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        } else {
          booksDiv.innerHTML = `<div class="alert alert-danger">Error al obtener los libros</div>`;
        }
      } catch (error) {
        booksDiv.innerHTML = `<div class="alert alert-danger">Error al obtener los libros</div>`;
      }
    });

    async function deleteBook(id) {
      try {
        const response = await fetch(`http://localhost:3000/api/books/${id}`, {
          method: 'DELETE'
        });
        if (response.ok) {
          alert('Libro eliminado');
          location.reload();
        } else {
          alert('Error al eliminar el libro');
        }
      } catch (error) {
        alert('Error al eliminar el libro');
      }
    }
    async function editBook(id) {
  try {
    console.log(id)
    // Obtener el libro a editar del servidor
    const response = await fetch(`http://localhost:3000/api/books/${id}`);
    
    if (response.ok) {
      const book = await response.json();
      
      // Llenar un formulario de edición con los datos del libro
      const editForm = document.getElementById('editBookForm');
      editForm.titulo.value = book.Titulo;
      editForm.autorID.value = book.AutorID;
      editForm.editorialID.value = book.EditorialID;
      editForm.precio.value = book.Precio;
      editForm.descripcion.value = book.Descripcion;
      editForm.categoriaID.value = book.CategoriaID;
      editForm.imagen.value = book.Imagen;
      
      
      // Mostrar el formulario de edición
      document.getElementById('editBookModal').style.display = 'block';
    } else {
      // Manejar errores si la solicitud no es exitosa
      throw new Error('Error al obtener el libro para editar');
    }
  } catch (error) {
    // Manejar errores de red u otros errores
    console.error('Error al obtener el libro para editar:', error);
    alert('Error al obtener el libro para editar');
  }
}
// Función para cerrar el modal de edición de libro
function closeEditModal() {
  document.getElementById('editBookModal').style.display = 'none';
}


    </script>
</body>

</html>
